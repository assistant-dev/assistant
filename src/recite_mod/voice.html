<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <title>Assistant</title>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link href="../css/style.css" rel="stylesheet" />
  </head>

  <body>
    <div class="ast-theme" id="app" data-theme="container">
      <button
        type="button"
        class="ast-theme"
        id="rc"
        data-theme="bprimary"
        onclick="/*start_reciting()*/"
      >
        <loc>start_rc</loc>
      </button>
      <div class="ast-theme" data-theme="progress" id="pg">
        <div
          class="ast-theme"
          data-theme="progress-bar"
          role="progressbar"
          aria-label="Animation"
          id="pgb"
        ></div>
      </div>
      <div class="realtime-diff">
        <b><loc>realtime_diff</loc></b>
        <span id="diff"></span>
      </div>
    </div>
    <script src="../js/app.js"></script>
    <script src="../js/lang.js"></script>
    <script src="../js/ifasr_new.js"></script>
    <script src="../js/diff.js"></script>
    <script src="../js/theming.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      window.onload = function () {
        let firstRun = detect_first_run();
        if (firstRun) {
          var link = document.createElement("a");
          link.href = "../first_run.html";
          link.click();
        }
      };
      let cfg = JSON.parse(fc(config_path()));
      update(cfg.language);
      let path = localStorage.getItem("project_path");
      let json_mfs = JSON.parse(fc(path + "/project.json"));
      let animation_interval = 0;
      let realText = [];
      function start_animation() {
        let progress_bar = $i("pgb");
        const itv = setInterval(function () {
          let width = progress_bar.style.width;
          if (width == "100%") {
            progress_bar.style.width = "0%";
          } else {
            progress_bar.style.width = parseInt(width) + 1 + "%";
          }
        }, 100);
        animation_interval = itv;
      }
      function stop_animation() {
        clearInterval(animation_interval);
        progress_bar.style.width = "100%";
        $("#pg").addClass("bg-success");
      }
      async function sleep(ms) {
        await setTimeout(function () {
          null;
        }, ms);
      }

      var mediaStreamRecorder = require("msr");

      var mediaConstraints = {
        audio: true,
      };

      navigator.getUserMedia(mediaConstraints, onMediaSuccess, onMediaError);

      function onMediaSuccess(stream) {
        var mediaRecorder = new mediaStreamRecorder(stream);
        mediaRecorder.mimeType = "audio/wav";
        mediaRecorder.ondataavailable = function (blob) {
          var blobURL = URL.createObjectURL(blob);
          console.log(blobURL);
        };
        mediaRecorder.start(3000);
      }

      function onMediaError(e) {
        console.error("media error", e);
      }

      async function start_reciting() {
        start_animation();
        let recorder = new mediaStreamRecorder({});
      }
    </script>
  </body>
</html>
