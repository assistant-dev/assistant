<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <title>Assistant</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">
        <link href="../css/style.css" rel="stylesheet">
    </head>
    <body>
        <div class="container" id="app">
            <loc>ocr_prompt</loc>
            <loc>image_prompt</loc><br>
            <input type="input" id="image_path" class="form-control" title="input">
            <br/>
            <button type="button" class="btn btn-primary" onclick="submit()"><loc>go_ahead</loc></button>
        </div>
  <!-- Hidden Button to Trigger Modal -->
    <button type="button" class="btn btn-primary hidden" data-bs-toggle="modal" data-bs-target="#exampleModal" id="modal_btn">
        __modal_launch__
    </button>
  <!-- Modal -->
  <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h1 class="modal-title fs-5" id="exampleModalLabel"><loc>sort_out</loc></h1>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
            <ol class="list-group list-group-numbered" id="list">
                <li class="list-group-item d-flex justify-content-between align-items-start">
                  <div class="ms-2 me-auto" id="content-1">
                    Content for list item
                  </div>
                  <button type="button" class="btn btn-primary" onclick="down(1)"><loc>down</loc></button>
                  <button type="button" class="btn btn-primary" onclick="up(1)"><loc>up</loc></button>
                </li>
              </ol>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          <button type="button" class="btn btn-primary">Save changes</button>
        </div>
      </div>
    </div>
  </div>
        <script src="../js/app.js"></script>
        <script src="../js/lang.js"></script>
        <script src="../js/ocr_general.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
        <script>
            window.onload = function() {
                let firstRun = detect_first_run();
                if (firstRun) {
                    var link = document.createElement('a');
                    link.href = "first_run.html";
                    link.click();
                }
                let cfg = JSON.parse(fc(config_path()));
                update(cfg.language);
            }
            let path = localStorage.getItem("project_path");
            let json_mfs = JSON.parse(fc(path+"/project.json"));
            function submit() {
                let imgpath = document.getElementById("image_path").value;
                // scan files in imgpath, only support jpg and png
                let files = [];
                fs.readdirSync(imgpath).forEach(file => {
                    if (file.endsWith(".jpg") || file.endsWith(".png") || file.endsWith(".jpeg")) {
                        files.push(file);
                    }
                });
                let texts = [];
                for (let i = 0; i < files.length; i++) {
                    let text = ocr(imgpath+"/"+files[i]);
                    texts.push(text);
                }
                let list = document.getElementById("list");
                for (let i = 0; i < texts.length; i++) {
                    let li = document.createElement("li");
                    li.className = "list-group-item d-flex justify-content-between align-items-start";
                    let div = document.createElement("div");
                    div.className = "ms-2 me-auto";
                    div.id = "content-"+(i+1);
                    div.innerHTML = texts[i];
                    let btn1 = document.createElement("button");
                    btn1.className = "btn btn-primary";
                    btn1.innerHTML = "<loc>down</loc>";
                    btn1.onclick = function() {
                        down(i+1);
                    }
                    let btn2 = document.createElement("button");
                    btn2.className = "btn btn-primary";
                    btn2.innerHTML = "<loc>up</loc>";
                    btn2.onclick = function() {
                        up(i+1);
                    }
                    li.appendChild(div);
                    li.appendChild(btn1);
                    li.appendChild(btn2);
                    list.appendChild(li);
                }
                let cfg = JSON.parse(fc(config_path()));
                update(cfg.language);
                document.getElementById("modal_btn").click();
            }
            function down(index) {
                let list = document.getElementById("list");
                let li = document.getElementById("content-"+index);
                let li2 = document.getElementById("content-"+(index+1));
                if (li2 == null) {
                    return;
                }
                let tmp = li.innerHTML;
                li.innerHTML = li2.innerHTML;
                li2.innerHTML = tmp;
            }
            function up(index) {
                let list = document.getElementById("list");
                let li = document.getElementById("content-"+index);
                let li2 = document.getElementById("content-"+(index-1));
                if (li2 == null) {
                    return;
                }
                let tmp = li.innerHTML;
                li.innerHTML = li2.innerHTML;
                li2.innerHTML = tmp;
            }
        </script>
    </body>
</html>